<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:jee="http://www.springframework.org/schema/jee"
    xmlns:lang="http://www.springframework.org/schema/lang"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xmlns:util="http://www.springframework.org/schema/util"
    xmlns:mvc="http://www.springframework.org/schema/mvc"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee.xsd
        http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang.xsd
        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
		http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd">
    
 	<context:annotation-config />
    <context:component-scan base-package="mymedia" />
    
	<!--Handle static content in /resources -->
	<context:component-scan base-package="spring.web" />
	<mvc:resources mapping="/resources/**" location="/resources/" />
	<bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter" />
	<bean class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping" />
    
    <bean id="jspViewResolver"
        class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="viewClass"
            value="org.springframework.web.servlet.view.JstlView" />
        <property name="prefix" value="/WEB-INF/" />
        <property name="suffix" value=".jsp" />
    </bean>
    
    <bean id="messageSource"
        class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
        <property name="basename" value="classpath:messages" />
        <property name="defaultEncoding" value="UTF-8" />
    </bean>
    
    <bean id="propertyConfigurer"
        class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="ignoreUnresolvablePlaceholders" value="true"/>
        <property name="ignoreResourceNotFound" value="true" />
        <property name="order" value="1"/>
        <property name="locations">
            <list>
                <!-- Default properties -->
                <value>classpath:default-swordfishsync.properties</value>
                <!-- User specific properties -->
                <value>file:${user.home}${file.separator}.swordfishsync${file.separator}swordfishsync.properties</value>
            </list>
        </property>
    </bean>
    
    <tx:annotation-driven />
    
    <bean id="dataSourceMyMedia"
        class="org.apache.commons.dbcp2.BasicDataSource" destroy-method="close"
        p:driverClassName="${database.driverclassname}"
        p:url="${database.databaseurl}" p:username="${database.username}"
        p:password="${database.password}" />
    <bean id="sessionFactoryMyMedia"
        class="org.springframework.orm.hibernate4.LocalSessionFactoryBean">
        <property name="dataSource" ref="dataSourceMyMedia" />
        <property name="configLocation">
            <value>classpath:hibernate.cfg.xml</value>
        </property>
        <property name="hibernateProperties">
            <props>
                <prop key="hibernate.dialect">${database.hibernate.dialect}</prop>
                <prop key="hibernate.show_sql">${database.hibernate.show_sql}</prop>
                <prop key="hibernate.format_sql">${database.hibernate.format_sql}</prop>
                <prop key="hibernate.hbm2ddl.auto">${database.hibernate.hbm2ddl.auto}</prop>
                <!-- <prop key="hibernate.connection.autocommit">true</prop> -->
            </props>
        </property>
    </bean>
    <bean id="transactionManagerMyMedia"
        class="org.springframework.orm.hibernate4.HibernateTransactionManager">
        <property name="sessionFactory" ref="sessionFactoryMyMedia" />
        <qualifier value="mymedia"/>
    </bean>
    
    <bean class="mymedia.services.MyMediaLifecycle" init-method="start" destroy-method="stop"></bean>
    
    <!--  MAIL SENDER API -->
    <bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
        <property name="host" value="${email.smtp.host}"/>
        <property name="port" value="${email.smtp.port}"/>
        <property name="defaultEncoding" value="UTF-8"/>
    </bean>
     <!-- SIMPLE MAIL MESSAGE TEMPLATES -->
    <bean id="defaultTemplateMessage" class="org.springframework.mail.SimpleMailMessage">
        <property name="from" value="${email.from}"/>
        <property name="subject" value="${media.notifications.default.subject}"/>
        <property name="text" value="${media.notifications.default.body}"/>
    </bean>
    <bean id="newDefaultTemplateMessage" class="org.springframework.mail.SimpleMailMessage">
        <property name="from" value="${email.from}"/>
        <property name="subject" value="${media.notifications.newdefault.subject}"/>
        <property name="text" value="${media.notifications.newdefault.body}"/>
    </bean>
    <bean id="newTvTemplateMessage" class="org.springframework.mail.SimpleMailMessage">
        <property name="from" value="${email.from}"/>
        <property name="subject" value="${media.notifications.newtv.subject}"/>
        <property name="text" value="${media.notifications.newtv.body}"/>
    </bean>
    <bean id="newMovieTemplateMessage" class="org.springframework.mail.SimpleMailMessage">
        <property name="from" value="${email.from}"/>
        <property name="subject" value="${media.notifications.newmovie.subject}"/>
        <property name="text" value="${media.notifications.newmovie.body}"/>
    </bean>
    <bean id="completedDefaultTemplateMessage" class="org.springframework.mail.SimpleMailMessage">
        <property name="from" value="${email.from}"/>
        <property name="subject" value="${media.notifications.completeddefault.subject}"/>
        <property name="text" value="${media.notifications.completeddefault.body}"/>
    </bean>
    <bean id="completedTvTemplateMessage" class="org.springframework.mail.SimpleMailMessage">
        <property name="from" value="${email.from}"/>
        <property name="subject" value="${media.notifications.completedtv.subject}"/>
        <property name="text" value="${media.notifications.completedtv.body}"/>
    </bean>
    <bean id="completedMovieTemplateMessage" class="org.springframework.mail.SimpleMailMessage">
        <property name="from" value="${email.from}"/>
        <property name="subject" value="${media.notifications.completedmovie.subject}"/>
        <property name="text" value="${media.notifications.completedmovie.body}"/>
    </bean>
    <!-- MAIL MANAGER -->
    <bean id="emailManager" class="mymedia.util.EmailManager">
        <property name="mailSender" ref="mailSender"/>
        <property name="defaultTemplateMessage" ref="defaultTemplateMessage"/>
        <property name="newDefaultTemplateMessage" ref="newDefaultTemplateMessage"/>
        <property name="newTvTemplateMessage" ref="newTvTemplateMessage"/>
        <property name="newMovieTemplateMessage" ref="newMovieTemplateMessage"/>
        <property name="completedDefaultTemplateMessage" ref="completedDefaultTemplateMessage"/>
        <property name="completedTvTemplateMessage" ref="completedTvTemplateMessage"/>
        <property name="completedMovieTemplateMessage" ref="completedMovieTemplateMessage"/>
    </bean>
    
    <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver" />
    
</beans>